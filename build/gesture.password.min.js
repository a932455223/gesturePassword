!function(t,i){function e(){for(var t=arguments[0],i=arguments.length,s=1;i>s;s++){var h=arguments[s];for(var n in h)h.hasOwnProperty(n)&&void 0!==h[n]&&("object"==typeof h[n]?(void 0===t[n]&&(t[n]={}),e(t[n],h[n])):t[n]=h[n])}return t}function s(t){var i=t.getBoundingClientRect(),e=document.body,s=document.documentElement,h=window.pageYOffset||s.scrollTop||e.scrollTop,n=window.pageXOffset||s.scrollLeft||e.scrollLeft,c=s.clientTop||e.clientTop||0,a=s.clientLeft||e.clientLeft||0,o=i.top+h+c,r=i.left+n+a;return{top:o,left:r}}function h(i,e){var s=t.getComputedStyle&&t.getComputedStyle(i,null)||i.currentStyle||i.style;return s[e]}function n(t,i,e){this.x=t,this.y=i,this.value=e}var c={circle:{sizeScale:1,lineWidth:3,"default":{strokeStyle:"#50A2E9"},wrong:{strokeStyle:"#D90106"},right:{strokeStyle:"#21864C"}},line:{lineWidth:3,"default":{strokeStyle:"#50A2E9"},wrong:{strokeStyle:"#D90106"},right:{strokeStyle:"#21864C"}},dot:{size:8,"default":{fillStyle:"#50A2E9"},wrong:{fillStyle:"#D90106"},right:{fillStyle:"#21864C"}}};i.prototype={constructor:i,init:function(t){this.size=this.container.offsetWidth-parseInt(h(this.container,"paddingLeft"))-parseInt(h(this.container,"paddingRight"))-parseInt(h(this.container,"borderLeftWidth"))-parseFloat(h(this.container,"borderRightWidth")),this.isDown=!1,this.touchId=!1,this.disable=!1,this.hasMoved=!1,this.state="default",this.config=e({},c,t),this.events={},this.cList=[],this.sList=[],this.isRedraw=!1,this.canvas=document.createElement("canvas"),this.canvas.width=this.size,this.canvas.height=this.size,this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.cr=(this.size/8-this.config.circle.lineWidth)*this.config.circle.sizeScale,this.cm=this.size-6*(this.cr+this.config.circle.lineWidth),this.drawCircle(),this.canvas.addEventListener("touchstart",this.handleDown.bind(this)),this.canvas.addEventListener("touchmove",this.handleMove.bind(this)),this.canvas.addEventListener("touchend",this.handleUp.bind(this)),this.canvas.addEventListener("mousedown",this.handleDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleUp.bind(this))},drawCircle:function(){this.ctx.strokeStyle=this.config.circle.default.strokeStyle,this.ctx.lineWidth=this.config.circle.lineWidth,this.cList=[];var t=[0,1,2];this.ctx.beginPath(),t.forEach(function(i){t.forEach(function(t){var e=(this.cr+this.config.circle.lineWidth+this.cm/6)*(2*t+1),s=(this.cr+this.config.circle.lineWidth)*(2*i+1)+2*i*this.cm/6;this.cList.push(new n(e,s,3*i+t+1)),this.ctx.moveTo(e+this.cr,s),this.ctx.arc(e,s,this.cr,0,2*Math.PI)}.bind(this))}.bind(this)),this.ctx.stroke(),this.backImg=this.ctx.getImageData(0,0,this.size,this.size)},fixEvent:function(t){var i=t.changedTouches?t.changedTouches[0]:t;return i.elementX=i.pageX-s(this.canvas).left,i.elementY=i.pageY-s(this.canvas).top,i.identifier="identifier"in i?i.identifier:0,i},draw:function(t){this.checkIn(t),this.ctx.clearRect(0,0,this.size,this.size),this.ctx.putImageData(this.backImg,0,0),this.isRedraw&&(this.drawPointAndLine(),this.isRedraw=!1);var i=this.sList[this.sList.length-1];i&&(this.ctx.strokeStyle=this.config.line[this.state].strokeStyle,this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(t.elementX,t.elementY),this.ctx.stroke())},drawPointAndLine:function(){for(var t=0;t<this.sList.length;t++){var i=this.sList[t];if(this.ctx.beginPath(),this.ctx.moveTo(i.x+this.cr,i.y),this.ctx.lineWidth=this.config.circle.lineWidth,this.ctx.fillStyle=this.config.dot[this.state].fillStyle,this.ctx.strokeStyle=this.config.circle[this.state].strokeStyle,this.ctx.arc(i.x,i.y,this.cr,0,2*Math.PI),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.config.dot.size,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath(),this.sList.length>=2&&t>=1){this.ctx.strokeStyle=this.config.line[this.state].strokeStyle,this.ctx.lineWidth=this.config.line[this.state].lineWidth;var e=this.sList[t-1];this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(i.x,i.y),this.ctx.closePath(),this.ctx.stroke()}}this.backImg=this.ctx.getImageData(0,0,this.size,this.size)},handleDown:function(t){if(t.preventDefault(),!this.disable){var i=this.fixEvent(t);this.isDown||(this.touchId=i.identifier,this.isDown=!0)}},handleUp:function(t){if(t.preventDefault(),!this.disable){var i=this.fixEvent(t);i.identifier===this.touchId&&(this.isDown=!1,this.ctx.clearRect(0,0,this.size,this.size),this.ctx.putImageData(this.backImg,0,0),this.hasMoved&&(this.disable=!0,this.emit("complete",this.getPassword())))}},handleMove:function(t){if(t.preventDefault(),!this.disable){var i=this.fixEvent(t);this.isDown&&i.identifier===this.touchId&&(this.hasMoved=!0,this.draw(i))}},checkIn:function(t){for(var i in this.cList){var e=this.cList[i].x,s=this.cList[i].y,h=Math.sqrt(Math.pow(e-t.elementX,2)+Math.pow(s-t.elementY,2),2);if(h<=this.cr){this.isRedraw=!0,this.sList.push(this.cList.splice(i,1)[0]);break}}},getPassword:function(){return this.sList.map(function(t){return t.value}).join("")},on:function(t,i){(this.events[t]||(this.events[t]=[])).push(i)},off:function(t,i){return void 0===this.events[t]||0===this.events[t].length?!1:(this.events[t].splice(this.events[t].indexOf(i),1),this.events[t].length)},emit:function(t){if(void 0===this.events[t])return!1;var i=arguments;this.events[t].forEach(function(t){t.apply(this,[].slice.call(i,1))}.bind(this))},setRight:function(){this.state="right",this.ctx.clearRect(0,0,this.size,this.size),this.drawCircle(),this.drawPointAndLine()},setWrong:function(){this.state="wrong",this.ctx.clearRect(0,0,this.size,this.size),this.drawCircle(),this.drawPointAndLine()},reset:function(){this.state="default",this.disable=!1,this.sList=[],this.ctx.clearRect(0,0,this.size,this.size),this.drawCircle()}},"function"==typeof define&&define.amd?define(i):"object"==typeof module&&module.exports?module.exports=i:t.GesturePassword=i}(this,function(t,i){return this instanceof arguments.callee?(this.container="string"==typeof t?document.getElementById(t):t,void this.init(i)):new arguments.callee.call(t,i)});